<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="using:OmegaPlayer.UI.Controls.TrackDisplay"
             xmlns:vm="using:OmegaPlayer.Features.Library.ViewModels"
             xmlns:helpers="using:OmegaPlayer.UI.Controls.Helpers"
             x:Class="OmegaPlayer.Features.Library.Views.DetailsView"
             x:DataType="vm:DetailsViewModel">

	<Grid>
		<!-- Main content layout with Grid instead of StackPanel -->
		<Grid.RowDefinitions>
			<!-- Header -->
			<RowDefinition Height="Auto"/>
			<!-- Content area - expands to fill space -->
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Border around Header -->
		<Border Classes="headerBorder">

			<!-- Adaptive Header -->
			<Grid Grid.Row="0"
				  Name="HeaderGrid"
				  Classes="header"
				  Background="{DynamicResource MainColor}"
				  IsVisible="{Binding !IsReorderMode}"
				  Margin="0">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>

				<!-- Content Image -->
				<Border x:Name="ImageBorder"
						Grid.Column="0"
						Margin="10 0 10 5"
						Height="160" Width="160"
						ClipToBounds="True"
						BorderBrush="{DynamicResource AccentColor}"
						BorderThickness="3"
						CornerRadius="5">
					<Image Source="{Binding Image}"
						   Stretch="UniformToFill"/>
				</Border>

				<!-- Title and Description -->
				<StackPanel Grid.Column="1" ClipToBounds="True"
							VerticalAlignment="Center">
					<TextBlock Text="{Binding ContentTypeText}"
							   Classes="HeaderContentType default"
							   Margin="10 0 0 40"
							   Opacity="0.7"/>
					<helpers:CustomTextBlock x:Name="TitleBlock"
											 Text="{Binding Title}"
											 Classes="HeaderTitle default"
											 HorizontalAlignment="Left"
											 ClipToBounds="False"
											 Margin="10 0 0 0"/>
					<TextBlock Text="{Binding Description}"
							   HorizontalAlignment="Left" Classes="default"
							   Margin="10 40 0 0"
							   TextWrapping="Wrap"
							   Opacity="0.9"/>
				</StackPanel>

				<!-- Header Buttons -->
				<WrapPanel x:Name="HeaderPanel"
						   Grid.Column="2"
						   MinWidth="400"
						   MaxWidth="800"
						   Orientation="Horizontal"
						   HorizontalAlignment="Right"
						   VerticalAlignment="Center"
						   Margin="0 0 10 0" >
					<!-- Main Play Button -->
					<Button Command="{Binding PlayAllOrSelectedCommand}"
							Classes="headerButton"
							IsVisible="{Binding !IsReorderMode}">
						<Button.Content>
							<StackPanel Orientation="Horizontal" Spacing="5">
								<PathIcon Data="{StaticResource PlayIcon}"
										  Classes="default"
										  Margin="0 0 5 0"/>
								<TextBlock Text="{Binding PlayButtonText}"
										   Classes="default"
										   Margin="0 1 0 0"/>
							</StackPanel>
						</Button.Content>
					</Button>

					<!-- Randomize - Not for NowPlaying -->
					<Button Command="{Binding RandomizeTracksCommand}"
							Classes="headerButton"
							IsVisible="{Binding !IsNowPlayingContent, Mode=OneWay}">
						<StackPanel Orientation="Horizontal" Spacing="5">
							<PathIcon Data="{StaticResource ShuffleOnIcon}" Classes="default"/>
							<TextBlock Text="{Localize Randomize}" Classes="default"/>
						</StackPanel>
					</Button>

					<!-- Add to Queue - Not for NowPlaying -->
					<Button Command="{Binding AddToQueueCommand}"
							Classes="headerButton"
							IsVisible="{Binding !IsNowPlayingContent, Mode=OneWay}">
						<StackPanel Orientation="Horizontal" Spacing="5">
							<PathIcon Data="{StaticResource AddTrackToQueueIcon}" Classes="default"/>
							<TextBlock Text="{Localize AddToQueue}" Classes="default"/>
						</StackPanel>
					</Button>

					<!-- Play Next - Not for NowPlaying -->
					<Button Command="{Binding PlayNextTracksCommand}"
							Classes="headerButton"
							IsVisible="{Binding !IsNowPlayingContent, Mode=OneWay}">
						<StackPanel Orientation="Horizontal" Spacing="5">
							<PathIcon Data="{StaticResource PlayNextTrackIcon}" Classes="default"/>
							<TextBlock Text="{Localize PlayNext}" Classes="default"/>
						</StackPanel>
					</Button>

					<!-- Add to Playlist -->
					<Button Command="{Binding ShowPlaylistSelectionDialogCommand}"
							Classes="headerButton">
						<Button.IsVisible>
							<MultiBinding Converter="{x:Static BoolConverters.And}">
								<Binding Path="!IsNowPlayingContent"/>
								<Binding Path="!IsReorderMode"/>
							</MultiBinding>
						</Button.IsVisible>
						<StackPanel Orientation="Horizontal" Spacing="5">
							<PathIcon Data="{StaticResource AddTrackIcon}" Classes="default"/>
							<TextBlock Text="{Localize AddToPlaylist}" Classes="default"/>
						</StackPanel>
					</Button>

					<!-- Clear Queue Button - For NowPlaying only -->
					<Button Command="{Binding ClearQueueCommand}"
							IsVisible="{Binding IsNowPlayingContent}"
							Classes="headerButton">
						<StackPanel Orientation="Horizontal" Spacing="5">
							<PathIcon Data="{StaticResource ClearIcon}" Classes="default"/>
							<TextBlock Text="{Localize ClearQueue}" Classes="default"/>
						</StackPanel>
					</Button>

					<!-- Edit Order Button - For Playlist and NowPlaying only -->
					<Button Command="{Binding EnterReorderModeCommand}"
							Classes="headerButton">
						<Button.IsVisible>
							<MultiBinding Converter="{x:Static BoolConverters.And}">
								<MultiBinding Converter="{x:Static BoolConverters.Or}">
									<Binding Path="IsPlaylistContent"/>
									<Binding Path="IsNowPlayingContent"/>
								</MultiBinding>
								<Binding Path="!IsReorderMode"/>
							</MultiBinding>
						</Button.IsVisible>
						<StackPanel Orientation="Horizontal" Spacing="5">
							<PathIcon Data="{StaticResource EditIcon}" Classes="default"/>
							<TextBlock Text="{Localize EditOrder}" Classes="default"/>
						</StackPanel>
					</Button>
				</WrapPanel>
			</Grid>
		</Border>

		<!-- Track Display -->
		<Grid Grid.Row="1" Margin="20,0,0,0">
			<TextBlock Text="No tracks found"
					   Classes="default"
					   IsVisible="{Binding HasNoTracks}"
					   HorizontalAlignment="Center"
					   VerticalAlignment="Center"
					   Margin="0,50"
					   Opacity="0.7"
					   FontSize="16"/>

			<!-- Floating Reorder Buttons -->
			<Border IsVisible="{Binding IsReorderMode}"
					HorizontalAlignment="Right"
					VerticalAlignment="Top"
					Margin="0,20,20,0"
					ZIndex="1000">
				<StackPanel Orientation="Horizontal"
							Spacing="10">
					<Button Command="{Binding SaveReorderedTracksCommand}"
							Classes="save"/>
					<Button Command="{Binding CancelReorderCommand}"
							Classes="cancel">
						<StackPanel Orientation="Horizontal" Spacing="5">
							<PathIcon Data="{StaticResource CloseIcon}"
									  Width="15" Height="15"
									  Foreground="Red"/>
							<TextBlock Text="{Localize Cancel}" Classes="default"/>
						</StackPanel>
					</Button>
				</StackPanel>
			</Border>

			<ScrollViewer x:Name="DetailsScrollviewer"
						  VerticalScrollBarVisibility="Visible"
						  HorizontalScrollBarVisibility="Disabled"
						  Padding="0"
						  Margin="0,0,0,8"
						  IsVisible="{Binding !HasNoTracks}"
						  ScrollChanged="ScrollViewer_ScrollChanged">
				<controls:TrackDisplayControl
					x:Name="TrackControl"
					ItemsSource="{Binding Tracks}"
					ViewType="{Binding CurrentViewType}"/>
			</ScrollViewer>
		</Grid>

		<!-- Loading Indicator -->
		<ProgressBar Grid.RowSpan="2"
					 IsVisible="{Binding IsLoading}"
					 Value="{Binding LoadingProgress}"
					 Classes="loading"
					 VerticalAlignment="Top"/>
	</Grid>

	<!-- Styles -->
	<UserControl.Styles>

		<Style Selector="TextBlock.HeaderContentType">
			<Setter Property="FontSize" Value="16"/>
			<Setter Property="Opacity" Value="0.7"/>
		</Style>

		<Style Selector="helpers|CustomTextBlock.HeaderTitle">
			<Setter Property="FontSize" Value="28"/>
			<Setter Property="FontWeight" Value="Bold"/>
		</Style>

		<!-- Save Button Style -->
		<Style Selector="Button.save /template/ ContentPresenter">
			<Setter Property="Background" Value="{DynamicResource MainColor}"/>
			<Setter Property="Foreground" Value="{DynamicResource TextColor}"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="CornerRadius" Value="25"/>
			<Setter Property="Content">
				<Template>
					<StackPanel Orientation="Horizontal" Spacing="5">
						<PathIcon Data="{StaticResource SaveEmptyIcon}" Classes="default"/>
						<TextBlock Text="{Localize SaveOrder}" Classes="default"/>
					</StackPanel>
				</Template>
			</Setter>
		</Style>
		<Style Selector="Button.save:pointerover /template/ ContentPresenter">
			<Setter Property="Background" Value="{DynamicResource SecondaryColor}"/>
			<Setter Property="Content">
				<Template>
					<StackPanel Orientation="Horizontal" Spacing="5">
						<PathIcon Data="{StaticResource SaveFilledIcon}" Classes="default"/>
						<TextBlock Text="{Localize SaveOrder}" Classes="default"/>
					</StackPanel>
				</Template>
			</Setter>
		</Style>

		<Style Selector="Button.cancel /template/ ContentPresenter">
			<Setter Property="Background" Value="{DynamicResource MainColor}"/>
			<Setter Property="Foreground" Value="{DynamicResource TextColor}"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="CornerRadius" Value="25"/>
		</Style>

		<Style Selector="Button.cancel:pointerover /template/ ContentPresenter">
			<Setter Property="Background" Value="{DynamicResource SecondaryColor}"/>
			<Setter Property="Foreground" Value="{DynamicResource TextColor}"/>
		</Style>

		<!-- Header Styles -->
		<Style Selector="Grid.header">
			<Setter Property="Height" Value="180"/>
			<Setter Property="Transitions">
				<Transitions>
					<DoubleTransition Property="Height" Duration="0:0:0.2"/>
				</Transitions>
			</Setter>
		</Style>
	</UserControl.Styles>
</UserControl>